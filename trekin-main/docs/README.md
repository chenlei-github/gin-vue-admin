# 📋 BrandTrekin 产品需求文档

> **完整的产品需求文档，适合Cursor AI进行开发**

---

## 🎯 项目概述

**项目名称**：BrandTrekin - 品牌市场分析平台  
**项目类型**：全栈Web应用（前端展示 + 后台管理 + MySQL数据库）  
**开发目标**：将现有基于JSON文件的静态展示系统，升级为基于MySQL数据库的动态管理系统

---

## 📚 文档目录

本产品需求文档分为以下几个部分，**请按顺序阅读**：

### 1️⃣ [主文档 - 项目概述](./PRD_MAIN.md)
- 项目概述和技术栈
- 核心功能模块
- 设计原则和注意事项
- 快速开始指南

### 2️⃣ [前端展示需求](./PRD_FRONTEND.md) ⭐ **重要**
- **首页 - 市场列表页**：完整布局、4个核心指标卡片、市场列表表格、趋势预览
- **市场详情页**：4个核心指标、市场趋势图表、品牌分布图表、品牌列表
- **品牌详情页**：4个核心指标、销售趋势图、社交媒体卡片、商品网格
- **所有数据指标的计算公式**（CAGR、市场规模、搜索量等）
- **UI/UX设计规范**（配色、组件、响应式）

### 3️⃣ [后台管理需求](./PRD_ADMIN.md) ⭐ **重要**
- **市场管理模块**：市场列表、添加/编辑/删除市场
- **数据导入模块**：5个文件上传组件、导入选项、导入进度
- **数据解析逻辑**：5种文件类型的详细解析代码
- **数据导入流程**：完整的导入流程和事务处理
- **导入历史模块**：导入历史列表、查看详情和日志

### 4️⃣ [数据库设计](./PRD_DATABASE.md) ⭐ **重要**
- **10张核心数据表**：完整的SQL建表语句
- **表关系图**：清晰的表关系结构
- **核心计算逻辑**：CAGR计算、聚合指标计算的SQL
- **索引优化**：所有索引的设计和说明
- **数据库初始化脚本**：一键创建所有表

### 5️⃣ [API接口设计](./PRD_API.md)
- **前端展示API**：3个核心接口（市场列表、市场详情、品牌详情）
- **后台管理API**：市场管理、数据导入、导入历史
- **统一响应格式**和错误码
- **请求/响应示例**

### 6️⃣ [开发任务清单](./PRD_TASKS.md)
- **Phase 1**：数据库设计与搭建（1-2天）
- **Phase 2**：后端API开发（3-5天）
- **Phase 3**：前端展示页面开发（2-3天）
- **Phase 4**：后台管理页面开发（4-6天）
- **Phase 5**：测试与优化（2-3天）
- **Phase 6**：部署上线（1-2天）
- **总预估时间**：13-21天

---

## 🚀 快速开始

### 第一步：阅读核心文档
请务必完整阅读以下3个核心文档：
1. **[前端展示需求](./PRD_FRONTEND.md)** - 了解所有页面的展示需求和数据指标
2. **[后台管理需求](./PRD_ADMIN.md)** - 了解后台管理功能和数据导入流程
3. **[数据库设计](./PRD_DATABASE.md)** - 了解数据库表结构和计算逻辑

### 第二步：搭建开发环境
```bash
# 1. 进入项目目录
cd /Users/leon/code/my-space/ai-code/gin-vue-admin/trekin-main

# 2. 安装依赖
npm install

# 3. 安装额外依赖（数据库、文件解析等）
npm install prisma @prisma/client xlsx papaparse

# 4. 配置数据库连接
# 创建 .env 文件，添加数据库连接信息
DATABASE_URL="mysql://user:password@localhost:3306/brandtrekin"

# 5. 初始化数据库
npx prisma migrate dev

# 6. 启动开发服务器
npm run dev
```

### 第三步：按阶段开发
参考 [开发任务清单](./PRD_TASKS.md)，按照Phase 1-6的顺序进行开发。

---

## 🛠 技术栈

### 前端
- **框架**：Next.js 14 (App Router)
- **语言**：TypeScript
- **UI库**：React 18
- **样式**：Tailwind CSS
- **图表**：Recharts
- **图标**：Lucide React

### 后端
- **运行时**：Node.js 20+
- **框架**：Next.js API Routes
- **数据库**：MySQL 8.0+
- **ORM**：Prisma (推荐) 或 TypeORM
- **文件解析**：xlsx + papaparse

---

## ⚠️ 重要注意事项

### 前端展示页面
- ✅ **保持现有布局**：不改变现有页面的布局结构
- ✅ **保持现有交互**：不改变现有的用户交互方式
- ✅ **保持现有样式**：不改变现有的视觉风格
- ⚠️ **仅改变数据源**：从读取JSON文件改为调用API接口

### 数据完整性
- ⚠️ **不要遗漏任何指标**：前端展示的每一个数据指标都必须在数据库中有对应字段
- ⚠️ **计算公式必须准确**：特别是CAGR、市场规模、搜索量等核心指标
- ⚠️ **数据关联必须正确**：品牌、商品、关键词等数据必须正确关联到市场

### 数据导入
- ⚠️ **5个文件缺一不可**：Brand-Social.xlsx、GKW.csv、KeywordHistory.xlsx、Product-US.xlsx、product-US-sales.xlsx
- ⚠️ **解析逻辑必须严格**：按照文档中的解析规则，不能随意修改
- ⚠️ **事务处理必须完整**：导入失败时必须回滚所有数据

---

## 📊 核心数据指标

### 市场级别指标
| 指标名称 | 计算公式 | 数据来源 |
|---------|---------|---------|
| 市场规模 | 最近12个月销售额总和 | market_monthly_trends |
| 市场增速(CAGR) | (Ending/Beginning)^(1/years)-1 | market_monthly_trends |
| 市场声量 | 最近月份搜索量总和 | keyword_monthly_volume |
| 品牌数量 | COUNT(DISTINCT brand_id) | brands |
| 商品数量 | COUNT(asin) | products |

### 品牌级别指标
| 指标名称 | 计算公式 | 数据来源 |
|---------|---------|---------|
| 品牌规模 | 最近12个月销售额总和 | brand_monthly_trends |
| 品牌增速(CAGR) | (Ending/Beginning)^(1/years)-1 | brand_monthly_trends |
| 商品数量 | COUNT(asin) | products |
| 社交媒体数据 | 直接读取 | brand_social_media |

### 商品级别指标
| 指标名称 | 计算公式 | 数据来源 |
|---------|---------|---------|
| 月销量 | 直接读取 | products |
| 销售趋势 | 最近6个月销售数据 | product_monthly_sales |
| 趋势百分比 | (最近-最早)/最早*100 | 计算字段 |

---

## 📁 项目结构

```
/trekin-main
├── docs/                          # 📋 产品需求文档（本目录）
│   ├── README.md                  # 文档总览（本文件）
│   ├── PRD_MAIN.md               # 主文档
│   ├── PRD_FRONTEND.md           # 前端展示需求 ⭐
│   ├── PRD_ADMIN.md              # 后台管理需求 ⭐
│   ├── PRD_DATABASE.md           # 数据库设计 ⭐
│   ├── PRD_API.md                # API接口设计
│   └── PRD_TASKS.md              # 开发任务清单
├── prisma/                        # Prisma ORM配置
│   └── schema.prisma
├── src/
│   ├── app/                       # Next.js App Router
│   │   ├── (frontend)/            # 前端展示页面
│   │   │   ├── page.tsx           # 首页
│   │   │   └── market/
│   │   │       └── [id]/
│   │   │           ├── page.tsx   # 市场详情页
│   │   │           └── brand/
│   │   │               └── [brand]/
│   │   │                   └── page.tsx  # 品牌详情页
│   │   ├── admin/                 # 后台管理页面
│   │   │   └── markets/
│   │   │       ├── page.tsx       # 市场列表
│   │   │       ├── create/        # 添加市场
│   │   │       ├── edit/          # 编辑市场
│   │   │       └── [id]/
│   │   │           └── import/    # 数据导入
│   │   └── api/                   # API Routes
│   │       ├── markets/           # 前端展示API
│   │       └── admin/             # 后台管理API
│   ├── components/                # React组件
│   ├── lib/                       # 工具函数
│   │   ├── db.ts                  # 数据库连接
│   │   ├── parsers/               # 文件解析器
│   │   └── calculators/           # 计算函数（CAGR等）
│   └── types/                     # TypeScript类型定义
├── public/
│   └── uploads/                   # 上传文件临时目录
├── .env                           # 环境变量
├── package.json
└── README.md                      # 项目README
```

---

## 🎨 设计规范

### 配色方案
```css
--primary: #2563eb;      /* 蓝色 */
--success: #10b981;      /* 绿色 */
--warning: #f59e0b;      /* 黄色 */
--danger: #ef4444;       /* 红色 */
--bg-primary: #ffffff;   /* 白色 */
--bg-secondary: #f8fafc; /* 浅灰 */
```

### 响应式断点
- **移动端**：< 768px（1列布局）
- **平板端**：768px - 1279px（2列布局）
- **桌面端**：≥ 1280px（4列布局）

---

## ✅ 开发检查清单

### 数据库
- [ ] 所有10张表创建成功
- [ ] 所有索引和外键创建成功
- [ ] CAGR计算逻辑正确
- [ ] 聚合指标计算正确

### 后端API
- [ ] 前端展示API（3个）开发完成
- [ ] 后台管理API开发完成
- [ ] 文件解析逻辑正确
- [ ] 数据导入流程正确
- [ ] 事务处理完整

### 前端展示
- [ ] 首页所有功能正常
- [ ] 市场详情页所有功能正常
- [ ] 品牌详情页所有功能正常
- [ ] 所有数据从API获取
- [ ] 响应式布局正常

### 后台管理
- [ ] 市场CRUD功能正常
- [ ] 5个文件上传组件正常
- [ ] 数据导入功能正常
- [ ] 导入进度实时显示
- [ ] 导入历史查看正常

---

## 📞 开发支持

### 参考资料
- **现有代码**：
  - `/src/app/page.tsx` - 首页实现
  - `/src/lib/parseData.js` - 数据解析逻辑
  - `/src/types/market.ts` - 类型定义
- **数据样例**：`/data/markets/` 目录下的JSON文件
- **原始数据**：Excel/CSV文件（需要手动准备）

### 常见问题
1. **Q: CAGR计算结果为null？**  
   A: 需要至少12个月的数据才能计算CAGR

2. **Q: 数据导入失败？**  
   A: 检查文件格式是否正确，必填列是否存在

3. **Q: 前端页面数据不显示？**  
   A: 检查API接口是否正常，数据库是否有数据

---

## 🎉 开始开发

现在你已经了解了整个项目的需求，可以开始开发了！

**建议开发顺序**：
1. 先阅读 [数据库设计](./PRD_DATABASE.md)，创建所有数据表
2. 再阅读 [后台管理需求](./PRD_ADMIN.md)，实现数据导入功能
3. 导入测试数据后，阅读 [前端展示需求](./PRD_FRONTEND.md)，改造前端页面
4. 最后参考 [开发任务清单](./PRD_TASKS.md)，完成所有任务

**祝开发顺利！🚀**

---

## 📝 版本历史

- **v1.0** (2025-10-28): 初始版本，包含完整的产品需求文档
