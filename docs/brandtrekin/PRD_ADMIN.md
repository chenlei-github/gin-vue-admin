# ğŸ”§ åå°ç®¡ç†éœ€æ±‚æ–‡æ¡£

> **æœ¬æ–‡æ¡£è¯¦ç»†æè¿°åå°ç®¡ç†ç³»ç»Ÿçš„æ‰€æœ‰åŠŸèƒ½æ¨¡å—ã€æ•°æ®å¯¼å…¥æµç¨‹å’Œè§£æé€»è¾‘**

---

## ğŸ“‹ ç›®å½•

1. [å¸‚åœºç®¡ç†æ¨¡å—](#1-å¸‚åœºç®¡ç†æ¨¡å—)
2. [æ•°æ®å¯¼å…¥æ¨¡å—](#2-æ•°æ®å¯¼å…¥æ¨¡å—)
3. [æ•°æ®è§£æé€»è¾‘](#3-æ•°æ®è§£æé€»è¾‘)
4. [æ•°æ®å¯¼å…¥æµç¨‹](#4-æ•°æ®å¯¼å…¥æµç¨‹)
5. [å¯¼å…¥å†å²æ¨¡å—](#5-å¯¼å…¥å†å²æ¨¡å—)

---

## 1ï¸âƒ£ å¸‚åœºç®¡ç†æ¨¡å—

### 1.1 å¸‚åœºåˆ—è¡¨é¡µ

#### é¡µé¢è·¯å¾„
```
/admin/markets
```

#### é¡µé¢å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [é¡µé¢æ ‡é¢˜]  å¸‚åœºç®¡ç†                    [+ æ·»åŠ å¸‚åœº]æŒ‰é’®    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [å¸‚åœºåˆ—è¡¨è¡¨æ ¼]                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ID â”‚å¸‚åœºåç§°  â”‚å¸‚åœºID    â”‚çŠ¶æ€    â”‚åˆ›å»ºæ—¶é—´  â”‚æ“ä½œ    â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ 1  â”‚CNC...    â”‚cnc-...   â”‚[å¼€å…³]  â”‚2025-...  â”‚[æ“ä½œ]  â”‚ â”‚
â”‚  â”‚ 2  â”‚Laser...  â”‚laser-... â”‚[å¼€å…³]  â”‚2025-...  â”‚[æ“ä½œ]  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è¡¨æ ¼åˆ—å®šä¹‰

| åˆ—å | å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|-----|------|------|------|
| ID | id | Integer | è‡ªå¢ä¸»é”® |
| å¸‚åœºåç§° | market_name | String | ä¸­æ–‡åç§°ï¼Œå¦‚"CNC Router Machine" |
| å¸‚åœºID | market_slug | String | è‹±æ–‡slugï¼Œç”¨äºURLï¼Œå¦‚"cnc-router-machine" |
| çŠ¶æ€ | status | Switch | å¯ç”¨/ç¦ç”¨å¼€å…³ï¼Œå®æ—¶åˆ‡æ¢ |
| åˆ›å»ºæ—¶é—´ | created_at | DateTime | æ ¼å¼ï¼šYYYY-MM-DD HH:mm:ss |
| æ“ä½œ | - | Actions | [ç¼–è¾‘] [åˆ é™¤] [å¯¼å…¥æ•°æ®] ä¸‰ä¸ªæŒ‰é’® |

#### æ“ä½œæŒ‰é’®

**ç¼–è¾‘æŒ‰é’®**
```typescript
{
  label: "ç¼–è¾‘",
  icon: "Edit",
  action: () => router.push(`/admin/markets/edit/${id}`)
}
```

**åˆ é™¤æŒ‰é’®**
```typescript
{
  label: "åˆ é™¤",
  icon: "Trash2",
  color: "danger",
  action: () => showDeleteConfirmModal(id)
}
```

**å¯¼å…¥æ•°æ®æŒ‰é’®**
```typescript
{
  label: "å¯¼å…¥æ•°æ®",
  icon: "Upload",
  color: "primary",
  action: () => router.push(`/admin/markets/${id}/import`)
}
```

---

### 1.2 æ·»åŠ å¸‚åœºé¡µ

#### é¡µé¢è·¯å¾„
```
/admin/markets/create
```

#### é¡µé¢å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [é¢åŒ…å±‘å¯¼èˆª]  å¸‚åœºç®¡ç† > æ·»åŠ å¸‚åœº                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [è¡¨å•åŒºåŸŸ]                                                  â”‚
â”‚                                                              â”‚
â”‚  å¸‚åœºåç§° *                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ CNC Router Machine                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  å¸‚åœºID (slug) *                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ cnc-router-machine                    [è‡ªåŠ¨ç”Ÿæˆ]æŒ‰é’®   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  æç¤ºï¼šç”¨äºURLï¼Œåªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—å’Œè¿å­—ç¬¦               â”‚
â”‚                                                              â”‚
â”‚  å¸‚åœºæè¿°                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  çŠ¶æ€                                                        â”‚
â”‚  â—‹ å¯ç”¨  â—‹ ç¦ç”¨                                             â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ [å–æ¶ˆ]     â”‚ [ä¿å­˜å¹¶å¯¼å…¥æ•°æ®]   â”‚ [ä¿å­˜]     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è¡¨å•å­—æ®µ

**å¸‚åœºåç§°** (å¿…å¡«)
```typescript
{
  name: "market_name",
  type: "text",
  label: "å¸‚åœºåç§°",
  placeholder: "å¦‚ï¼šCNC Router Machine",
  required: true,
  maxLength: 100,
  validation: {
    required: "å¸‚åœºåç§°ä¸èƒ½ä¸ºç©º",
    maxLength: "å¸‚åœºåç§°ä¸èƒ½è¶…è¿‡100ä¸ªå­—ç¬¦"
  },
  onChange: (value) => {
    // è‡ªåŠ¨ç”Ÿæˆslug
    autoGenerateSlug(value);
  }
}
```

**å¸‚åœºID (slug)** (å¿…å¡«)
```typescript
{
  name: "market_slug",
  type: "text",
  label: "å¸‚åœºID (slug)",
  placeholder: "å¦‚ï¼šcnc-router-machine",
  required: true,
  maxLength: 100,
  pattern: /^[a-z0-9-]+$/,
  validation: {
    required: "å¸‚åœºIDä¸èƒ½ä¸ºç©º",
    pattern: "åªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—å’Œè¿å­—ç¬¦",
    unique: "è¯¥å¸‚åœºIDå·²å­˜åœ¨"  // éœ€è¦å¼‚æ­¥æ ¡éªŒ
  },
  helperText: "ç”¨äºURLï¼Œåªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—å’Œè¿å­—ç¬¦",
  actions: [
    {
      label: "è‡ªåŠ¨ç”Ÿæˆ",
      action: () => generateSlugFromName()
    }
  ]
}
```

**è‡ªåŠ¨ç”ŸæˆSlugé€»è¾‘**
```javascript
function generateSlug(name) {
  return name
    .toLowerCase()
    .replace(/[^a-z0-9\s-]/g, '')  // ç§»é™¤ç‰¹æ®Šå­—ç¬¦
    .replace(/\s+/g, '-')           // ç©ºæ ¼æ›¿æ¢ä¸ºè¿å­—ç¬¦
    .replace(/-+/g, '-')            // å¤šä¸ªè¿å­—ç¬¦åˆå¹¶ä¸ºä¸€ä¸ª
    .trim();
}

// ç¤ºä¾‹
generateSlug("CNC Router Machine") // => "cnc-router-machine"
generateSlug("Laser Engraver & Cutter") // => "laser-engraver-cutter"
```

**å¸‚åœºæè¿°** (å¯é€‰)
```typescript
{
  name: "description",
  type: "textarea",
  label: "å¸‚åœºæè¿°",
  placeholder: "ç®€è¦æè¿°è¯¥å¸‚åœº...",
  rows: 4,
  maxLength: 500
}
```

**çŠ¶æ€** (å¿…å¡«)
```typescript
{
  name: "status",
  type: "radio",
  label: "çŠ¶æ€",
  options: [
    { label: "å¯ç”¨", value: "active" },
    { label: "ç¦ç”¨", value: "inactive" }
  ],
  defaultValue: "active"
}
```

#### æŒ‰é’®æ“ä½œ

**å–æ¶ˆæŒ‰é’®**
```typescript
{
  label: "å–æ¶ˆ",
  variant: "outline",
  action: () => router.back()
}
```

**ä¿å­˜æŒ‰é’®**
```typescript
{
  label: "ä¿å­˜",
  variant: "primary",
  action: async () => {
    const result = await createMarket(formData);
    if (result.success) {
      showSuccessMessage("å¸‚åœºåˆ›å»ºæˆåŠŸ");
      router.push("/admin/markets");
    }
  }
}
```

**ä¿å­˜å¹¶å¯¼å…¥æ•°æ®æŒ‰é’®**
```typescript
{
  label: "ä¿å­˜å¹¶å¯¼å…¥æ•°æ®",
  variant: "primary",
  action: async () => {
    const result = await createMarket(formData);
    if (result.success) {
      router.push(`/admin/markets/${result.data.id}/import`);
    }
  }
}
```

---

### 1.3 ç¼–è¾‘å¸‚åœºé¡µ

#### é¡µé¢è·¯å¾„
```
/admin/markets/edit/:id
```

#### é¡µé¢å¸ƒå±€
ä¸æ·»åŠ å¸‚åœºé¡µç›¸åŒï¼Œä½†ï¼š
1. è¡¨å•å­—æ®µé¢„å¡«å……ç°æœ‰æ•°æ®
2. å¸‚åœºID (slug) å­—æ®µç¦ç”¨ç¼–è¾‘ï¼ˆé˜²æ­¢ç ´åç°æœ‰é“¾æ¥ï¼‰
3. é¡µé¢æ ‡é¢˜æ”¹ä¸º"ç¼–è¾‘å¸‚åœº"

#### ç‰¹æ®Šè¯´æ˜
```typescript
{
  name: "market_slug",
  type: "text",
  label: "å¸‚åœºID (slug)",
  disabled: true,  // ç¦ç”¨ç¼–è¾‘
  helperText: "å¸‚åœºIDåˆ›å»ºåä¸å¯ä¿®æ”¹ï¼Œä»¥ä¿æŒURLç¨³å®šæ€§"
}
```

---

### 1.4 åˆ é™¤å¸‚åœºåŠŸèƒ½

#### è§¦å‘æ–¹å¼
ç‚¹å‡»å¸‚åœºåˆ—è¡¨ä¸­çš„[åˆ é™¤]æŒ‰é’®

#### ç¡®è®¤å¼¹çª—
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸  ç¡®è®¤åˆ é™¤                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  åˆ é™¤å¸‚åœºå°†åŒæ—¶åˆ é™¤è¯¥å¸‚åœºä¸‹çš„æ‰€æœ‰æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š                â”‚
â”‚  â€¢ æ‰€æœ‰å“ç‰Œä¿¡æ¯                                              â”‚
â”‚  â€¢ æ‰€æœ‰å•†å“ä¿¡æ¯                                              â”‚
â”‚  â€¢ æ‰€æœ‰å…³é”®è¯æ•°æ®                                            â”‚
â”‚  â€¢ æ‰€æœ‰é”€å”®æ•°æ®                                              â”‚
â”‚  â€¢ æ‰€æœ‰è¶‹åŠ¿æ•°æ®                                              â”‚
â”‚                                                              â”‚
â”‚  âš ï¸ æ­¤æ“ä½œä¸å¯æ¢å¤ï¼                                         â”‚
â”‚                                                              â”‚
â”‚  è¯·è¾“å…¥å¸‚åœºåç§°ä»¥ç¡®è®¤åˆ é™¤ï¼š                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚ [å–æ¶ˆ]     â”‚ [ç¡®è®¤åˆ é™¤] â”‚                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åˆ é™¤é€»è¾‘
```javascript
async function deleteMarket(marketId, confirmName) {
  // 1. è·å–å¸‚åœºä¿¡æ¯
  const market = await getMarketById(marketId);
  
  // 2. æ ¡éªŒè¾“å…¥çš„åç§°
  if (confirmName !== market.market_name) {
    throw new Error("å¸‚åœºåç§°ä¸åŒ¹é…");
  }
  
  // 3. å¼€å¯æ•°æ®åº“äº‹åŠ¡
  const transaction = await db.beginTransaction();
  
  try {
    // 4. æŒ‰é¡ºåºåˆ é™¤å…³è”æ•°æ®ï¼ˆä»å­è¡¨åˆ°çˆ¶è¡¨ï¼‰
    await transaction.execute(`
      DELETE FROM product_monthly_sales 
      WHERE asin IN (
        SELECT asin FROM products WHERE market_id = ?
      )
    `, [marketId]);
    
    await transaction.execute(`
      DELETE FROM products WHERE market_id = ?
    `, [marketId]);
    
    await transaction.execute(`
      DELETE FROM brand_monthly_trends 
      WHERE brand_id IN (
        SELECT id FROM brands WHERE market_id = ?
      )
    `, [marketId]);
    
    await transaction.execute(`
      DELETE FROM brand_social_media 
      WHERE brand_id IN (
        SELECT id FROM brands WHERE market_id = ?
      )
    `, [marketId]);
    
    await transaction.execute(`
      DELETE FROM brands WHERE market_id = ?
    `, [marketId]);
    
    await transaction.execute(`
      DELETE FROM keyword_monthly_volume 
      WHERE keyword_id IN (
        SELECT id FROM keywords WHERE market_id = ?
      )
    `, [marketId]);
    
    await transaction.execute(`
      DELETE FROM keywords WHERE market_id = ?
    `, [marketId]);
    
    await transaction.execute(`
      DELETE FROM market_monthly_trends WHERE market_id = ?
    `, [marketId]);
    
    await transaction.execute(`
      DELETE FROM import_logs WHERE market_id = ?
    `, [marketId]);
    
    await transaction.execute(`
      DELETE FROM markets WHERE id = ?
    `, [marketId]);
    
    // 5. æäº¤äº‹åŠ¡
    await transaction.commit();
    
    return { success: true, message: "å¸‚åœºåˆ é™¤æˆåŠŸ" };
    
  } catch (error) {
    // 6. å›æ»šäº‹åŠ¡
    await transaction.rollback();
    throw error;
  }
}
```

---

## 2ï¸âƒ£ æ•°æ®å¯¼å…¥æ¨¡å—

### 2.1 æ•°æ®å¯¼å…¥é¡µ

#### é¡µé¢è·¯å¾„
```
/admin/markets/:id/import
```

#### é¡µé¢å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [é¢åŒ…å±‘å¯¼èˆª]  å¸‚åœºç®¡ç† > {å¸‚åœºåç§°} > æ•°æ®å¯¼å…¥              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [é¡µé¢æ ‡é¢˜]  å¯¼å…¥å¸‚åœºæ•°æ® - {å¸‚åœºåç§°}                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ä¸Šä¼ ç»„ä»¶1] å“ç‰Œç¤¾äº¤åª’ä½“æ•°æ®                                â”‚
â”‚  ğŸ“„ Brand-Social.xlsx                                        â”‚
â”‚  åŒ…å«å“ç‰Œåç§°ã€ç‹¬ç«‹ç«™ã€YouTubeã€Instagramã€Facebookã€Reddit  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [é€‰æ‹©æ–‡ä»¶]                              çŠ¶æ€ï¼šæœªä¸Šä¼     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ä¸Šä¼ ç»„ä»¶2] Googleå…³é”®è¯æ•°æ®                                â”‚
â”‚  ğŸ“„ GKW.csv                                                  â”‚
â”‚  åŒ…å«Googleå…³é”®è¯åŠæœˆåº¦æœç´¢é‡å†å²æ•°æ®                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [é€‰æ‹©æ–‡ä»¶]                              çŠ¶æ€ï¼šæœªä¸Šä¼     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ä¸Šä¼ ç»„ä»¶3] Amazonå…³é”®è¯å†å²æ•°æ®                            â”‚
â”‚  ğŸ“„ KeywordHistory.xlsx                                      â”‚
â”‚  åŒ…å«Amazonå…³é”®è¯åŠæœˆåº¦æœç´¢é‡å†å²æ•°æ®                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [é€‰æ‹©æ–‡ä»¶]                              çŠ¶æ€ï¼šæœªä¸Šä¼     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ä¸Šä¼ ç»„ä»¶4] å•†å“åŸºç¡€ä¿¡æ¯                                    â”‚
â”‚  ğŸ“„ Product-US.xlsx                                          â”‚
â”‚  åŒ…å«ASINã€æ ‡é¢˜ã€å“ç‰Œã€ä»·æ ¼ã€è¯„åˆ†ã€è¯„è®ºæ•°ã€å›¾ç‰‡URLç­‰         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [é€‰æ‹©æ–‡ä»¶]                              çŠ¶æ€ï¼šæœªä¸Šä¼     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ä¸Šä¼ ç»„ä»¶5] å•†å“æœˆåº¦é”€å”®æ•°æ®                                â”‚
â”‚  ğŸ“„ product-US-sales.xlsx                                    â”‚
â”‚  åŒ…å«ASINåŠæ¯æœˆé”€å”®é¢ã€é”€é‡æ•°æ®                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [é€‰æ‹©æ–‡ä»¶]                              çŠ¶æ€ï¼šæœªä¸Šä¼     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [å¯¼å…¥é€‰é¡¹]                                                  â”‚
â”‚                                                              â”‚
â”‚  å¯¼å…¥æ¨¡å¼ï¼š                                                  â”‚
â”‚  â— å¢é‡å¯¼å…¥ï¼ˆä¿ç•™ç°æœ‰æ•°æ®ï¼Œä»…æ·»åŠ æˆ–æ›´æ–°ï¼‰                   â”‚
â”‚  â—‹ å…¨é‡æ›¿æ¢ï¼ˆåˆ é™¤æ‰€æœ‰æ•°æ®åé‡æ–°å¯¼å…¥ï¼‰                       â”‚
â”‚                                                              â”‚
â”‚  æ•°æ®æ ¡éªŒï¼š                                                  â”‚
â”‚  â˜‘ è·³è¿‡æ— æ•ˆæ•°æ®è¡Œ                                           â”‚
â”‚  â˜‘ è‡ªåŠ¨åˆ›å»ºä¸å­˜åœ¨çš„å“ç‰Œ                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [å¯¼å…¥è¿›åº¦åŒºåŸŸ]                                              â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  65%          â”‚
â”‚  å½“å‰æ­¥éª¤ï¼šå¯¼å…¥å•†å“æ•°æ®...                                   â”‚
â”‚                                                              â”‚
â”‚  [æ—¥å¿—è¾“å‡º]                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [2025-10-28 10:30:01] å¼€å§‹è§£ææ–‡ä»¶...                  â”‚ â”‚
â”‚  â”‚ [2025-10-28 10:30:02] è§£æBrand-Social.xlsxæˆåŠŸï¼Œ25è¡Œ  â”‚ â”‚
â”‚  â”‚ [2025-10-28 10:30:03] è§£æGKW.csvæˆåŠŸï¼Œ150è¡Œ           â”‚ â”‚
â”‚  â”‚ [2025-10-28 10:30:05] å¼€å§‹å¯¼å…¥å“ç‰Œæ•°æ®...              â”‚ â”‚
â”‚  â”‚ [2025-10-28 10:30:06] æˆåŠŸå¯¼å…¥25ä¸ªå“ç‰Œ                 â”‚ â”‚
â”‚  â”‚ ...                                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ [å–æ¶ˆ]     â”‚ [æŸ¥çœ‹å¯¼å…¥å†å²]     â”‚ [å¼€å§‹å¯¼å…¥] â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ–‡ä»¶ä¸Šä¼ ç»„ä»¶

#### ç»„ä»¶çŠ¶æ€
```typescript
type UploadStatus = 
  | "idle"           // æœªä¸Šä¼ 
  | "uploading"      // ä¸Šä¼ ä¸­
  | "parsing"        // è§£æä¸­
  | "success"        // è§£ææˆåŠŸ
  | "error";         // è§£æå¤±è´¥

interface UploadComponent {
  fileType: "brand_social" | "gkw" | "keyword_history" | "product_us" | "product_sales";
  title: string;
  fileName: string;
  description: string;
  acceptedTypes: string[];
  status: UploadStatus;
  file: File | null;
  preview: any[] | null;      // å‰5è¡Œæ•°æ®é¢„è§ˆ
  error: string | null;
}
```

#### 5ä¸ªä¸Šä¼ ç»„ä»¶é…ç½®

**ç»„ä»¶1ï¼šå“ç‰Œç¤¾äº¤åª’ä½“æ•°æ®**
```typescript
{
  fileType: "brand_social",
  title: "å“ç‰Œç¤¾äº¤åª’ä½“æ•°æ®",
  fileName: "Brand-Social.xlsx",
  description: "åŒ…å«å“ç‰Œåç§°ã€ç‹¬ç«‹ç«™ã€YouTubeã€Instagramã€Facebookã€Redditæ•°æ®",
  acceptedTypes: [".xlsx"],
  expectedColumns: [
    "Brand",                    // å¿…å¡«
    "Website",                  // å¯é€‰
    "YouTube",                  // å¯é€‰
    "YouTube Subscribers",      // å¯é€‰
    "Instagram",                // å¯é€‰
    "Instagram Followers",      // å¯é€‰
    "Facebook",                 // å¯é€‰
    "Facebook Followers",       // å¯é€‰
    "Reddit",                   // å¯é€‰
    "Reddit Posts"              // å¯é€‰
  ]
}
```

**ç»„ä»¶2ï¼šGoogleå…³é”®è¯æ•°æ®**
```typescript
{
  fileType: "gkw",
  title: "Googleå…³é”®è¯æ•°æ®",
  fileName: "GKW.csv",
  description: "åŒ…å«Googleå…³é”®è¯åŠæœˆåº¦æœç´¢é‡å†å²æ•°æ®",
  acceptedTypes: [".csv"],
  expectedColumns: [
    "Keyword",                  // å¿…å¡«
    "YYYY-MM",                  // åŠ¨æ€åˆ—ï¼ˆæœˆä»½ï¼‰
    // ... æ›´å¤šæœˆä»½åˆ—
  ]
}
```

**ç»„ä»¶3ï¼šAmazonå…³é”®è¯å†å²æ•°æ®**
```typescript
{
  fileType: "keyword_history",
  title: "Amazonå…³é”®è¯å†å²æ•°æ®",
  fileName: "KeywordHistory.xlsx",
  description: "åŒ…å«Amazonå…³é”®è¯åŠæœˆåº¦æœç´¢é‡å†å²æ•°æ®",
  acceptedTypes: [".xlsx"],
  expectedColumns: [
    "Keyword",                  // å¿…å¡«
    "YYYY-MM",                  // åŠ¨æ€åˆ—ï¼ˆæœˆä»½ï¼‰
    // ... æ›´å¤šæœˆä»½åˆ—
  ]
}
```

**ç»„ä»¶4ï¼šå•†å“åŸºç¡€ä¿¡æ¯**
```typescript
{
  fileType: "product_us",
  title: "å•†å“åŸºç¡€ä¿¡æ¯",
  fileName: "Product-US.xlsx",
  description: "åŒ…å«ASINã€æ ‡é¢˜ã€å“ç‰Œã€ä»·æ ¼ã€è¯„åˆ†ã€è¯„è®ºæ•°ã€å›¾ç‰‡URLç­‰",
  acceptedTypes: [".xlsx"],
  expectedColumns: [
    "ASIN",                     // å¿…å¡«
    "Title",                    // å¿…å¡«
    "Brand",                    // å¿…å¡«
    "Price",                    // å¯é€‰
    "Rating",                   // å¯é€‰
    "Reviews",                  // å¯é€‰
    "Image",                    // å¯é€‰
    "Monthly Sales"             // å¯é€‰
  ]
}
```

**ç»„ä»¶5ï¼šå•†å“æœˆåº¦é”€å”®æ•°æ®**
```typescript
{
  fileType: "product_sales",
  title: "å•†å“æœˆåº¦é”€å”®æ•°æ®",
  fileName: "product-US-sales.xlsx",
  description: "åŒ…å«ASINåŠæ¯æœˆé”€å”®é¢ã€é”€é‡æ•°æ®",
  acceptedTypes: [".xlsx"],
  expectedColumns: [
    "ASIN",                     // å¿…å¡«
    "YYYY-MM",                  // åŠ¨æ€åˆ—ï¼ˆæœˆä»½ï¼‰
    // ... æ›´å¤šæœˆä»½åˆ—
  ]
}
```

#### ä¸Šä¼ æµç¨‹
```javascript
async function handleFileUpload(fileType, file) {
  // 1. æ›´æ–°çŠ¶æ€ä¸º"ä¸Šä¼ ä¸­"
  setStatus(fileType, "uploading");
  
  // 2. ä¸Šä¼ æ–‡ä»¶åˆ°æœåŠ¡å™¨
  const uploadResult = await uploadFile(file);
  
  if (!uploadResult.success) {
    setStatus(fileType, "error");
    setError(fileType, uploadResult.error);
    return;
  }
  
  // 3. æ›´æ–°çŠ¶æ€ä¸º"è§£æä¸­"
  setStatus(fileType, "parsing");
  
  // 4. è§£ææ–‡ä»¶
  const parseResult = await parseFile(fileType, uploadResult.fileId);
  
  if (!parseResult.success) {
    setStatus(fileType, "error");
    setError(fileType, parseResult.error);
    return;
  }
  
  // 5. æ›´æ–°çŠ¶æ€ä¸º"æˆåŠŸ"ï¼Œæ˜¾ç¤ºé¢„è§ˆ
  setStatus(fileType, "success");
  setPreview(fileType, parseResult.preview);  // å‰5è¡Œæ•°æ®
}
```

#### æ•°æ®é¢„è§ˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… è§£ææˆåŠŸï¼å…± 25 è¡Œæ•°æ®                                   â”‚
â”‚                                                              â”‚
â”‚  [æ•°æ®é¢„è§ˆï¼ˆå‰5è¡Œï¼‰]                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Brand      â”‚ Website    â”‚ YouTube    â”‚ YouTube... â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚ Genmitsu   â”‚ https://...â”‚ https://...â”‚ 50000      â”‚     â”‚
â”‚  â”‚ Ortur      â”‚ https://...â”‚ https://...â”‚ 30000      â”‚     â”‚
â”‚  â”‚ ...        â”‚ ...        â”‚ ...        â”‚ ...        â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                              â”‚
â”‚  [é‡æ–°ä¸Šä¼ ]                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3ï¸âƒ£ æ•°æ®è§£æé€»è¾‘

### 3.1 è§£æBrand-Social.xlsx

#### æœŸæœ›çš„Excelç»“æ„
```
| Brand      | Website         | YouTube         | YouTube Subscribers | Instagram       | Instagram Followers | Facebook        | Facebook Followers | Reddit          | Reddit Posts |
|------------|-----------------|-----------------|---------------------|-----------------|---------------------|-----------------|--------------------|-----------------|--------------| 
| Genmitsu   | https://...     | https://...     | 50000               | https://...     | 30000               | https://...     | 20000              | https://...     | 500          |
| Ortur      | https://...     | https://...     | 30000               | https://...     | 15000               | https://...     | 10000              | https://...     | 200          |
```

#### è§£æä»£ç 
```javascript
import * as XLSX from 'xlsx';

async function parseBrandSocial(file, marketId) {
  // 1. è¯»å–Excelæ–‡ä»¶
  const workbook = XLSX.read(await file.arrayBuffer());
  const sheetName = workbook.SheetNames[0];
  const sheet = workbook.Sheets[sheetName];
  
  // 2. è½¬æ¢ä¸ºJSON
  const data = XLSX.utils.sheet_to_json(sheet);
  
  // 3. æ ¡éªŒå¿…å¡«åˆ—
  if (data.length === 0) {
    throw new Error("æ–‡ä»¶ä¸ºç©º");
  }
  
  const firstRow = data[0];
  if (!firstRow.Brand) {
    throw new Error("ç¼ºå°‘å¿…å¡«åˆ—ï¼šBrand");
  }
  
  // 4. è§£ææ¯ä¸€è¡Œ
  const brands = [];
  const errors = [];
  
  for (let i = 0; i < data.length; i++) {
    const row = data[i];
    const rowNumber = i + 2;  // Excelè¡Œå·ï¼ˆä»2å¼€å§‹ï¼Œå› ä¸ºç¬¬1è¡Œæ˜¯è¡¨å¤´ï¼‰
    
    // è·³è¿‡ç©ºè¡Œ
    if (!row.Brand || row.Brand.trim() === '') {
      continue;
    }
    
    try {
      brands.push({
        market_id: marketId,
        brand_name: row.Brand.trim(),
        website: row.Website || null,
        
        // YouTubeæ•°æ®
        youtube_url: row.YouTube || null,
        youtube_subscribers: parseInt(row['YouTube Subscribers']) || 0,
        
        // Instagramæ•°æ®
        instagram_url: row.Instagram || null,
        instagram_followers: parseInt(row['Instagram Followers']) || 0,
        
        // Facebookæ•°æ®
        facebook_url: row.Facebook || null,
        facebook_followers: parseInt(row['Facebook Followers']) || 0,
        
        // Redditæ•°æ®
        reddit_url: row.Reddit || null,
        reddit_posts: parseInt(row['Reddit Posts']) || 0
      });
    } catch (error) {
      errors.push({
        row: rowNumber,
        error: error.message
      });
    }
  }
  
  return {
    success: true,
    data: brands,
    total: brands.length,
    errors: errors,
    preview: brands.slice(0, 5)  // å‰5è¡Œé¢„è§ˆ
  };
}
```

---

### 3.2 è§£æGKW.csv

#### æœŸæœ›çš„CSVç»“æ„
```
Keyword,2023-01,2023-02,2023-03,2023-04,...
cnc router,120000,125000,130000,135000,...
laser engraver,80000,82000,85000,88000,...
```

#### è§£æä»£ç 
```javascript
import Papa from 'papaparse';

async function parseGKW(file, marketId) {
  return new Promise((resolve, reject) => {
    Papa.parse(file, {
      header: true,
      skipEmptyLines: true,
      complete: (results) => {
        try {
          const keywords = [];
          const errors = [];
          
          for (let i = 0; i < results.data.length; i++) {
            const row = results.data[i];
            const rowNumber = i + 2;
            
            // è·³è¿‡æ²¡æœ‰å…³é”®è¯çš„è¡Œ
            if (!row.Keyword || row.Keyword.trim() === '') {
              continue;
            }
            
            const keyword = row.Keyword.trim();
            const monthlyVolumes = [];
            
            // è§£ææ¯ä¸ªæœˆä»½åˆ—
            for (const [key, value] of Object.entries(row)) {
              if (key === 'Keyword') continue;
              
              // æ ¡éªŒæ—¥æœŸæ ¼å¼ï¼ˆYYYY-MMï¼‰
              if (!/^\d{4}-\d{2}$/.test(key)) {
                errors.push({
                  row: rowNumber,
                  error: `æ— æ•ˆçš„æ—¥æœŸæ ¼å¼ï¼š${key}`
                });
                continue;
              }
              
              // è§£ææœç´¢é‡
              const volume = parseInt(value);
              if (!isNaN(volume) && volume > 0) {
                monthlyVolumes.push({
                  date: `${key}-01`,  // è½¬æ¢ä¸ºå®Œæ•´æ—¥æœŸæ ¼å¼
                  volume: volume
                });
              }
            }
            
            if (monthlyVolumes.length > 0) {
              keywords.push({
                market_id: marketId,
                keyword: keyword,
                source: 'google',
                monthly_volumes: monthlyVolumes
              });
            }
          }
          
          resolve({
            success: true,
            data: keywords,
            total: keywords.length,
            errors: errors,
            preview: keywords.slice(0, 5)
          });
          
        } catch (error) {
          reject(error);
        }
      },
      error: (error) => {
        reject(error);
      }
    });
  });
}
```

---

### 3.3 è§£æKeywordHistory.xlsx

#### æœŸæœ›çš„Excelç»“æ„
```
| Keyword        | 2023-01 | 2023-02 | 2023-03 | ... |
|----------------|---------|---------|---------|-----|
| cnc router     | 150000  | 155000  | 160000  | ... |
| laser engraver | 100000  | 105000  | 110000  | ... |
```

#### è§£æä»£ç 
```javascript
async function parseKeywordHistory(file, marketId) {
  // ä¸parseGKWç±»ä¼¼ï¼Œä½†sourceä¸º'amazon'
  const workbook = XLSX.read(await file.arrayBuffer());
  const sheetName = workbook.SheetNames[0];
  const sheet = workbook.Sheets[sheetName];
  const data = XLSX.utils.sheet_to_json(sheet);
  
  const keywords = [];
  const errors = [];
  
  for (let i = 0; i < data.length; i++) {
    const row = data[i];
    const rowNumber = i + 2;
    
    if (!row.Keyword || row.Keyword.trim() === '') {
      continue;
    }
    
    const keyword = row.Keyword.trim();
    const monthlyVolumes = [];
    
    for (const [key, value] of Object.entries(row)) {
      if (key === 'Keyword') continue;
      
      if (!/^\d{4}-\d{2}$/.test(key)) {
        errors.push({
          row: rowNumber,
          error: `æ— æ•ˆçš„æ—¥æœŸæ ¼å¼ï¼š${key}`
        });
        continue;
      }
      
      const volume = parseInt(value);
      if (!isNaN(volume) && volume > 0) {
        monthlyVolumes.push({
          date: `${key}-01`,
          volume: volume
        });
      }
    }
    
    if (monthlyVolumes.length > 0) {
      keywords.push({
        market_id: marketId,
        keyword: keyword,
        source: 'amazon',  // æ³¨æ„ï¼šè¿™é‡Œæ˜¯amazon
        monthly_volumes: monthlyVolumes
      });
    }
  }
  
  return {
    success: true,
    data: keywords,
    total: keywords.length,
    errors: errors,
    preview: keywords.slice(0, 5)
  };
}
```

---

### 3.4 è§£æProduct-US.xlsx

#### æœŸæœ›çš„Excelç»“æ„
```
| ASIN       | Title                  | Brand    | Price  | Rating | Reviews | Image                | Monthly Sales |
|------------|------------------------|----------|--------|--------|---------|----------------------|---------------|
| B08XYZ123  | CNC Router Machine...  | Genmitsu | 299.99 | 4.5    | 1234    | https://...          | 500           |
| B09ABC456  | Laser Engraver...      | Ortur    | 199.99 | 4.7    | 2345    | https://...          | 800           |
```

#### è§£æä»£ç 
```javascript
async function parseProductUS(file, marketId) {
  const workbook = XLSX.read(await file.arrayBuffer());
  const sheetName = workbook.SheetNames[0];
  const sheet = workbook.Sheets[sheetName];
  const data = XLSX.utils.sheet_to_json(sheet);
  
  // æ ¡éªŒå¿…å¡«åˆ—
  if (data.length === 0) {
    throw new Error("æ–‡ä»¶ä¸ºç©º");
  }
  
  const firstRow = data[0];
  const requiredColumns = ['ASIN', 'Title', 'Brand'];
  for (const col of requiredColumns) {
    if (!firstRow.hasOwnProperty(col)) {
      throw new Error(`ç¼ºå°‘å¿…å¡«åˆ—ï¼š${col}`);
    }
  }
  
  const products = [];
  const errors = [];
  
  for (let i = 0; i < data.length; i++) {
    const row = data[i];
    const rowNumber = i + 2;
    
    // æ ¡éªŒå¿…å¡«å­—æ®µ
    if (!row.ASIN || !row.Title || !row.Brand) {
      errors.push({
        row: rowNumber,
        error: "ç¼ºå°‘å¿…å¡«å­—æ®µï¼ˆASINã€Titleæˆ–Brandï¼‰"
      });
      continue;
    }
    
    try {
      products.push({
        market_id: marketId,
        asin: row.ASIN.trim(),
        title: row.Title.trim(),
        brand: row.Brand.trim(),
        price: parseFloat(row.Price) || 0,
        rating: parseFloat(row.Rating) || 0,
        reviews: parseInt(row.Reviews) || 0,
        image_url: row.Image || null,
        monthly_sales: parseInt(row['Monthly Sales']) || 0
      });
    } catch (error) {
      errors.push({
        row: rowNumber,
        error: error.message
      });
    }
  }
  
  return {
    success: true,
    data: products,
    total: products.length,
    errors: errors,
    preview: products.slice(0, 5)
  };
}
```

---

### 3.5 è§£æproduct-US-sales.xlsx

#### æœŸæœ›çš„Excelç»“æ„
```
| ASIN       | 2023-01 | 2023-02 | 2023-03 | ... |
|------------|---------|---------|---------|-----|
| B08XYZ123  | 15000   | 16000   | 17000   | ... |
| B09ABC456  | 25000   | 26000   | 27000   | ... |
```

#### è§£æä»£ç 
```javascript
async function parseProductSales(file, marketId) {
  const workbook = XLSX.read(await file.arrayBuffer());
  const sheetName = workbook.SheetNames[0];
  const sheet = workbook.Sheets[sheetName];
  const data = XLSX.utils.sheet_to_json(sheet);
  
  const productSales = [];
  const errors = [];
  
  for (let i = 0; i < data.length; i++) {
    const row = data[i];
    const rowNumber = i + 2;
    
    if (!row.ASIN || row.ASIN.trim() === '') {
      continue;
    }
    
    const asin = row.ASIN.trim();
    const monthlySales = [];
    
    for (const [key, value] of Object.entries(row)) {
      if (key === 'ASIN') continue;
      
      if (!/^\d{4}-\d{2}$/.test(key)) {
        errors.push({
          row: rowNumber,
          error: `æ— æ•ˆçš„æ—¥æœŸæ ¼å¼ï¼š${key}`
        });
        continue;
      }
      
      const sales = parseFloat(value);
      if (!isNaN(sales) && sales > 0) {
        monthlySales.push({
          date: `${key}-01`,
          sales: sales,
          units: 0  // å¦‚æœæœ‰é”€é‡æ•°æ®ï¼Œå¯ä»¥ä»å¦ä¸€ä¸ªsheetè¯»å–
        });
      }
    }
    
    if (monthlySales.length > 0) {
      productSales.push({
        asin: asin,
        monthly_sales: monthlySales
      });
    }
  }
  
  return {
    success: true,
    data: productSales,
    total: productSales.length,
    errors: errors,
    preview: productSales.slice(0, 5)
  };
}
```

---

## 4ï¸âƒ£ æ•°æ®å¯¼å…¥æµç¨‹

### 4.1 å¯¼å…¥æµç¨‹å›¾

```
å¼€å§‹å¯¼å…¥
    â†“
[Step 1] æ ¡éªŒæ‰€æœ‰æ–‡ä»¶å·²ä¸Šä¼ 
    â†“
[Step 2] å¼€å¯æ•°æ®åº“äº‹åŠ¡
    â†“
[Step 3] å¦‚æœæ˜¯"å…¨é‡æ›¿æ¢"æ¨¡å¼ï¼Œåˆ é™¤ç°æœ‰æ•°æ®
    â†“
[Step 4] å¯¼å…¥å“ç‰ŒåŸºç¡€ä¿¡æ¯
    â”œâ”€ æ’å…¥brandsè¡¨
    â””â”€ æ’å…¥brand_social_mediaè¡¨
    â†“
[Step 5] å¯¼å…¥å•†å“åŸºç¡€ä¿¡æ¯
    â”œâ”€ æŸ¥æ‰¾æˆ–åˆ›å»ºbrand_id
    â””â”€ æ’å…¥productsè¡¨
    â†“
[Step 6] å¯¼å…¥å…³é”®è¯æ•°æ®
    â”œâ”€ æ’å…¥keywordsè¡¨
    â””â”€ æ’å…¥keyword_monthly_volumeè¡¨
    â†“
[Step 7] å¯¼å…¥å•†å“é”€å”®æ•°æ®
    â””â”€ æ’å…¥product_monthly_salesè¡¨
    â†“
[Step 8] è®¡ç®—èšåˆæŒ‡æ ‡
    â”œâ”€ è®¡ç®—brand_monthly_trends
    â”œâ”€ è®¡ç®—market_monthly_trends
    â”œâ”€ è®¡ç®—CAGR
    â””â”€ æ›´æ–°marketsè¡¨ç»Ÿè®¡æ•°æ®
    â†“
[Step 9] æäº¤äº‹åŠ¡
    â†“
[Step 10] è®°å½•å¯¼å…¥æ—¥å¿—
    â†“
å®Œæˆå¯¼å…¥
```

### 4.2 å¯¼å…¥ä»£ç å®ç°

```javascript
async function importMarketData(marketId, files, options) {
  const {
    importMode,           // 'incremental' | 'replace'
    skipInvalid,          // boolean
    autoCreateBrand       // boolean
  } = options;
  
  const log = [];
  const stats = {
    brands: 0,
    products: 0,
    keywords: 0,
    salesRecords: 0,
    skipped: 0
  };
  
  try {
    log.push(`[${timestamp()}] å¼€å§‹å¯¼å…¥æ•°æ®...`);
    
    // Step 1: æ ¡éªŒæ–‡ä»¶
    log.push(`[${timestamp()}] æ ¡éªŒæ–‡ä»¶...`);
    const requiredFiles = ['brand_social', 'gkw', 'keyword_history', 'product_us', 'product_sales'];
    for (const fileType of requiredFiles) {
      if (!files[fileType]) {
        throw new Error(`ç¼ºå°‘å¿…éœ€æ–‡ä»¶ï¼š${fileType}`);
      }
    }
    
    // Step 2: å¼€å¯äº‹åŠ¡
    log.push(`[${timestamp()}] å¼€å¯æ•°æ®åº“äº‹åŠ¡...`);
    const transaction = await db.beginTransaction();
    
    try {
      // Step 3: å…¨é‡æ›¿æ¢æ¨¡å¼ - åˆ é™¤ç°æœ‰æ•°æ®
      if (importMode === 'replace') {
        log.push(`[${timestamp()}] åˆ é™¤ç°æœ‰æ•°æ®...`);
        await deleteMarketData(transaction, marketId);
      }
      
      // Step 4: å¯¼å…¥å“ç‰Œæ•°æ®
      log.push(`[${timestamp()}] å¯¼å…¥å“ç‰Œæ•°æ®...`);
      const brandResult = await importBrands(
        transaction,
        marketId,
        files.brand_social,
        { skipInvalid }
      );
      stats.brands = brandResult.imported;
      stats.skipped += brandResult.skipped;
      log.push(`[${timestamp()}] æˆåŠŸå¯¼å…¥ ${brandResult.imported} ä¸ªå“ç‰Œ`);
      
      // Step 5: å¯¼å…¥å•†å“æ•°æ®
      log.push(`[${timestamp()}] å¯¼å…¥å•†å“æ•°æ®...`);
      const productResult = await importProducts(
        transaction,
        marketId,
        files.product_us,
        { skipInvalid, autoCreateBrand }
      );
      stats.products = productResult.imported;
      stats.skipped += productResult.skipped;
      log.push(`[${timestamp()}] æˆåŠŸå¯¼å…¥ ${productResult.imported} ä¸ªå•†å“`);
      
      // Step 6: å¯¼å…¥å…³é”®è¯æ•°æ®
      log.push(`[${timestamp()}] å¯¼å…¥å…³é”®è¯æ•°æ®...`);
      const keywordResult = await importKeywords(
        transaction,
        marketId,
        files.gkw,
        files.keyword_history,
        { skipInvalid }
      );
      stats.keywords = keywordResult.imported;
      stats.skipped += keywordResult.skipped;
      log.push(`[${timestamp()}] æˆåŠŸå¯¼å…¥ ${keywordResult.imported} ä¸ªå…³é”®è¯`);
      
      // Step 7: å¯¼å…¥é”€å”®æ•°æ®
      log.push(`[${timestamp()}] å¯¼å…¥é”€å”®æ•°æ®...`);
      const salesResult = await importSalesData(
        transaction,
        files.product_sales,
        { skipInvalid }
      );
      stats.salesRecords = salesResult.imported;
      stats.skipped += salesResult.skipped;
      log.push(`[${timestamp()}] æˆåŠŸå¯¼å…¥ ${salesResult.imported} æ¡é”€å”®è®°å½•`);
      
      // Step 8: è®¡ç®—èšåˆæŒ‡æ ‡
      log.push(`[${timestamp()}] è®¡ç®—èšåˆæŒ‡æ ‡...`);
      await calculateAggregates(transaction, marketId);
      log.push(`[${timestamp()}] èšåˆæŒ‡æ ‡è®¡ç®—å®Œæˆ`);
      
      // Step 9: æäº¤äº‹åŠ¡
      log.push(`[${timestamp()}] æäº¤äº‹åŠ¡...`);
      await transaction.commit();
      log.push(`[${timestamp()}] æ•°æ®å¯¼å…¥æˆåŠŸï¼`);
      
      // Step 10: è®°å½•å¯¼å…¥æ—¥å¿—
      await saveImportLog(marketId, {
        importMode,
        status: 'success',
        stats,
        log: log.join('\n')
      });
      
      return {
        success: true,
        stats,
        log
      };
      
    } catch (error) {
      // å›æ»šäº‹åŠ¡
      log.push(`[${timestamp()}] é”™è¯¯ï¼š${error.message}`);
      log.push(`[${timestamp()}] å›æ»šäº‹åŠ¡...`);
      await transaction.rollback();
      
      // è®°å½•å¤±è´¥æ—¥å¿—
      await saveImportLog(marketId, {
        importMode,
        status: 'failed',
        stats,
        error: error.message,
        log: log.join('\n')
      });
      
      throw error;
    }
    
  } catch (error) {
    return {
      success: false,
      error: error.message,
      log
    };
  }
}
```

### 4.3 è®¡ç®—èšåˆæŒ‡æ ‡

```javascript
async function calculateAggregates(transaction, marketId) {
  // 1. è®¡ç®—å“ç‰Œæœˆåº¦è¶‹åŠ¿
  await transaction.execute(`
    INSERT INTO brand_monthly_trends (brand_id, date, revenue)
    SELECT 
      p.brand_id,
      pms.date,
      SUM(pms.sales) as revenue
    FROM product_monthly_sales pms
    JOIN products p ON pms.asin = p.asin
    WHERE p.market_id = ?
    GROUP BY p.brand_id, pms.date
    ON DUPLICATE KEY UPDATE revenue = VALUES(revenue)
  `, [marketId]);
  
  // 2. è®¡ç®—å¸‚åœºæœˆåº¦è¶‹åŠ¿ï¼ˆé”€å”®é¢ï¼‰
  await transaction.execute(`
    INSERT INTO market_monthly_trends (market_id, date, revenue)
    SELECT 
      b.market_id,
      bmt.date,
      SUM(bmt.revenue) as revenue
    FROM brand_monthly_trends bmt
    JOIN brands b ON bmt.brand_id = b.id
    WHERE b.market_id = ?
    GROUP BY b.market_id, bmt.date
    ON DUPLICATE KEY UPDATE revenue = VALUES(revenue)
  `, [marketId]);
  
  // 3. è®¡ç®—å¸‚åœºæœˆåº¦è¶‹åŠ¿ï¼ˆæœç´¢é‡ï¼‰
  await transaction.execute(`
    UPDATE market_monthly_trends mmt
    SET search_volume = (
      SELECT COALESCE(SUM(kmv.volume), 0)
      FROM keyword_monthly_volume kmv
      JOIN keywords k ON kmv.keyword_id = k.id
      WHERE k.market_id = mmt.market_id
        AND kmv.date = mmt.date
    )
    WHERE mmt.market_id = ?
  `, [marketId]);
  
  // 4. è®¡ç®—å“ç‰ŒCAGR
  await transaction.execute(`
    UPDATE brands b
    SET cagr = (
      SELECT 
        CASE 
          WHEN COUNT(*) >= 12 AND MIN(revenue) > 0 THEN
            LEAST(999, GREATEST(-99, 
              (POWER(MAX(revenue) / MIN(revenue), 1.0 / (COUNT(*) / 12.0)) - 1) * 100
            ))
          ELSE NULL
        END
      FROM brand_monthly_trends
      WHERE brand_id = b.id
    )
    WHERE b.market_id = ?
  `, [marketId]);
  
  // 5. è®¡ç®—å¸‚åœºCAGR
  await transaction.execute(`
    UPDATE markets m
    SET cagr = (
      SELECT 
        CASE 
          WHEN COUNT(*) >= 12 AND MIN(revenue) > 0 THEN
            LEAST(999, GREATEST(-99, 
              (POWER(MAX(revenue) / MIN(revenue), 1.0 / (COUNT(*) / 12.0)) - 1) * 100
            ))
          ELSE NULL
        END
      FROM market_monthly_trends
      WHERE market_id = m.id
    )
    WHERE m.id = ?
  `, [marketId]);
  
  // 6. æ›´æ–°å“ç‰Œæ€»é”€å”®é¢
  await transaction.execute(`
    UPDATE brands b
    SET total_revenue = (
      SELECT COALESCE(SUM(revenue), 0)
      FROM brand_monthly_trends
      WHERE brand_id = b.id
        AND date >= DATE_SUB(CURDATE(), INTERVAL 12 MONTH)
    )
    WHERE b.market_id = ?
  `, [marketId]);
  
  // 7. æ›´æ–°å“ç‰Œå•†å“æ•°é‡
  await transaction.execute(`
    UPDATE brands b
    SET product_count = (
      SELECT COUNT(*)
      FROM products
      WHERE brand_id = b.id
    )
    WHERE b.market_id = ?
  `, [marketId]);
  
  // 8. æ›´æ–°å¸‚åœºæ€»é”€å”®é¢
  await transaction.execute(`
    UPDATE markets m
    SET total_revenue = (
      SELECT COALESCE(SUM(revenue), 0)
      FROM market_monthly_trends
      WHERE market_id = m.id
        AND date >= DATE_SUB(CURDATE(), INTERVAL 12 MONTH)
    )
    WHERE m.id = ?
  `, [marketId]);
  
  // 9. æ›´æ–°å¸‚åœºå•†å“æ€»æ•°
  await transaction.execute(`
    UPDATE markets m
    SET total_products = (
      SELECT COUNT(*)
      FROM products
      WHERE market_id = m.id
    )
    WHERE m.id = ?
  `, [marketId]);
  
  // 10. æ›´æ–°å¸‚åœºå“ç‰Œæ•°é‡
  await transaction.execute(`
    UPDATE markets m
    SET brand_count = (
      SELECT COUNT(*)
      FROM brands
      WHERE market_id = m.id
    )
    WHERE m.id = ?
  `, [marketId]);
  
  // 11. æ›´æ–°å¸‚åœºæœç´¢é‡
  await transaction.execute(`
    UPDATE markets m
    SET search_volume = (
      SELECT COALESCE(SUM(kmv.volume), 0)
      FROM keyword_monthly_volume kmv
      JOIN keywords k ON kmv.keyword_id = k.id
      WHERE k.market_id = m.id
        AND kmv.date = (
          SELECT MAX(date) FROM keyword_monthly_volume
        )
    )
    WHERE m.id = ?
  `, [marketId]);
}
```

---

## 5ï¸âƒ£ å¯¼å…¥å†å²æ¨¡å—

### 5.1 å¯¼å…¥å†å²åˆ—è¡¨é¡µ

#### é¡µé¢è·¯å¾„
```
/admin/markets/:id/import-history
```

#### é¡µé¢å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [é¢åŒ…å±‘å¯¼èˆª]  å¸‚åœºç®¡ç† > {å¸‚åœºåç§°} > å¯¼å…¥å†å²              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [é¡µé¢æ ‡é¢˜]  å¯¼å…¥å†å² - {å¸‚åœºåç§°}                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [å¯¼å…¥å†å²åˆ—è¡¨è¡¨æ ¼]                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚å¯¼å…¥æ—¶é—´  â”‚æ“ä½œäºº  â”‚å¯¼å…¥æ¨¡å¼â”‚çŠ¶æ€    â”‚ç»Ÿè®¡ä¿¡æ¯â”‚æ“ä½œ    â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚2025-...  â”‚admin   â”‚å¢é‡    â”‚âœ…æˆåŠŸ  â”‚å“ç‰Œ25..â”‚[è¯¦æƒ…]  â”‚ â”‚
â”‚  â”‚2025-...  â”‚admin   â”‚å…¨é‡    â”‚âŒå¤±è´¥  â”‚å“ç‰Œ0... â”‚[æ—¥å¿—]  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è¡¨æ ¼åˆ—å®šä¹‰

| åˆ—å | å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|-----|------|------|------|
| å¯¼å…¥æ—¶é—´ | created_at | DateTime | YYYY-MM-DD HH:mm:ss |
| æ“ä½œäºº | created_by | String | ç®¡ç†å‘˜ç”¨æˆ·å |
| å¯¼å…¥æ¨¡å¼ | import_mode | Badge | "å¢é‡å¯¼å…¥" æˆ– "å…¨é‡æ›¿æ¢" |
| çŠ¶æ€ | status | Badge | "æˆåŠŸ"ï¼ˆç»¿è‰²ï¼‰/ "å¤±è´¥"ï¼ˆçº¢è‰²ï¼‰/ "éƒ¨åˆ†æˆåŠŸ"ï¼ˆé»„è‰²ï¼‰|
| ç»Ÿè®¡ä¿¡æ¯ | - | Text | "å“ç‰ŒXä¸ªï¼Œå•†å“Xä¸ªï¼Œå…³é”®è¯Xä¸ª" |
| æ“ä½œ | - | Actions | [æŸ¥çœ‹è¯¦æƒ…] [æŸ¥çœ‹æ—¥å¿—] |

---

## âœ… åå°ç®¡ç†å¼€å‘æ£€æŸ¥æ¸…å•

### å¸‚åœºç®¡ç†
- [ ] å¸‚åœºåˆ—è¡¨é¡µæ­£ç¡®æ˜¾ç¤ºæ‰€æœ‰å¸‚åœº
- [ ] çŠ¶æ€å¼€å…³å¯ä»¥å®æ—¶åˆ‡æ¢
- [ ] æ·»åŠ å¸‚åœºè¡¨å•æ ¡éªŒæ­£ç¡®
- [ ] å¸‚åœºIDè‡ªåŠ¨ç”ŸæˆåŠŸèƒ½æ­£å¸¸
- [ ] å¸‚åœºIDå”¯ä¸€æ€§æ ¡éªŒæ­£å¸¸
- [ ] ç¼–è¾‘å¸‚åœºåŠŸèƒ½æ­£å¸¸
- [ ] åˆ é™¤å¸‚åœºéœ€è¦è¾“å…¥åç§°ç¡®è®¤
- [ ] åˆ é™¤å¸‚åœºçº§è”åˆ é™¤æ‰€æœ‰å…³è”æ•°æ®
- [ ] åˆ é™¤æ“ä½œä½¿ç”¨äº‹åŠ¡ï¼Œå¤±è´¥æ—¶å›æ»š

### æ•°æ®å¯¼å…¥
- [ ] 5ä¸ªæ–‡ä»¶ä¸Šä¼ ç»„ä»¶æ­£å¸¸å·¥ä½œ
- [ ] æ–‡ä»¶ç±»å‹æ ¡éªŒæ­£ç¡®
- [ ] æ–‡ä»¶è§£æé€»è¾‘æ­£ç¡®
- [ ] è§£ææˆåŠŸåæ˜¾ç¤ºå‰5è¡Œé¢„è§ˆ
- [ ] è§£æå¤±è´¥æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
- [ ] å¯¼å…¥æ¨¡å¼é€‰æ‹©æ­£å¸¸
- [ ] å¯¼å…¥é€‰é¡¹å‹¾é€‰æ­£å¸¸
- [ ] å¯¼å…¥è¿›åº¦å®æ—¶æ˜¾ç¤º
- [ ] å¯¼å…¥æ—¥å¿—å®æ—¶è¾“å‡º
- [ ] å¯¼å…¥æˆåŠŸæ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
- [ ] å¯¼å…¥å¤±è´¥å›æ»šæ‰€æœ‰æ•°æ®
- [ ] èšåˆæŒ‡æ ‡è®¡ç®—æ­£ç¡®
- [ ] CAGRè®¡ç®—æ­£ç¡®

### å¯¼å…¥å†å²
- [ ] å¯¼å…¥å†å²åˆ—è¡¨æ­£ç¡®æ˜¾ç¤º
- [ ] å¯ä»¥æŸ¥çœ‹å¯¼å…¥è¯¦æƒ…
- [ ] å¯ä»¥æŸ¥çœ‹å¯¼å…¥æ—¥å¿—
- [ ] çŠ¶æ€æ˜¾ç¤ºæ­£ç¡®ï¼ˆæˆåŠŸ/å¤±è´¥/éƒ¨åˆ†æˆåŠŸï¼‰

---

**åå°ç®¡ç†éœ€æ±‚æ–‡æ¡£å®Œæˆï¼è¯·ç»§ç»­é˜…è¯»æ•°æ®åº“è®¾è®¡æ–‡æ¡£ã€‚**
